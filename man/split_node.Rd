% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/treeBuilding.R
\name{split_node}
\alias{split_node}
\title{Recursive split builder for weighted tree (internal function)
Recursive split builder for weighted tree (internal function)}
\usage{
split_node(
  split_feature,
  X,
  D,
  parent_loss,
  depth,
  explore_proba = 0.05,
  choose_feature_fn = choose_feature,
  loss_fn = loss,
  reduce_weight_fn = reduce_weight,
  objective_fn = objective_default,
  max_depth = 8,
  min_leaf_n = 5,
  log_fn = function(...) {
 },
  max_rejects_per_node = 1000
)
}
\arguments{
\item{split_feature}{Named numeric vector of feature selection probabilities (should include a "leaf" option).}

\item{X}{Data frame of current observations (must include at least the feature chosen for splitting if applicable; may also include a working copy of weights \code{w}).}

\item{D}{Data frame representing the global state (must include columns \code{w} for weights and \code{vsq} for squared pseudo-outcomes, with row names aligning to observations).}

\item{parent_loss}{Numeric, the loss value of the parent node (used to decide if a split improves the objective).}

\item{depth}{Integer, current depth of the node in the tree.}

\item{explore_proba}{Numeric in \verb{[0,1]}, probability of exploring the suboptimal assignment at a leaf (randomly flipping the chosen weight).}

\item{choose_feature_fn}{Function to choose the next feature to split; default \code{choose_feature}.}

\item{loss_fn}{Function to compute loss given a tentative weight assignment; if \code{NULL}, it is set via \code{loss_from_objective(objective_fn)}.}

\item{reduce_weight_fn}{Function to adjust feature probabilities when a split is rejected; default \code{reduce_weight}.}

\item{objective_fn}{Function that maps \code{D} â†’ scalar objective; used for node summaries and to derive \code{loss_fn} when \code{loss_fn} is \code{NULL}.}

\item{max_depth}{Integer maximum depth of the tree. If the current depth equals \code{max_depth}, the node is made a leaf.}

\item{min_leaf_n}{Integer minimum number of observations required to attempt a split. If \code{X} has <= \code{min_leaf_n} rows, the node becomes a leaf.}

\item{log_fn}{Function for logging debug messages. Default no-op.}

\item{max_rejects_per_node}{Integer. A safety budget for how many times a node
may \emph{reject} non-improving splits before the algorithm gives up and
finalizes the node as a leaf. Each rejection halves the probability of the
last-tried feature (via \code{reduce_weight_fn}) and samples a new candidate
feature to try again. This prevents infinite recursion / stack overflows in
adversarial or flat objective landscapes. Larger values allow more
exploration at a node (potentially better splits but slower), while smaller
values make the builder more conservative (fewer retries, faster, more
leaves). Default: \code{1000}.}
}
\value{
A list representing the tree/subtree.
}
\description{
Recursively builds a weighted decision tree to optimize an objective function,
using an exploration/exploitation trade-off. This function is internal and is
used by \code{tree_opt()} / \code{ROOT()} to construct a single tree.
}
